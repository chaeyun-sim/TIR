# 10. ë¦¬ì•¡íŠ¸ 17ê³¼ 18ì˜ ë³€ê²½ ì‚¬í•­ ì‚´í´ë³´ê¸°

## ğŸ· ë¦¬ì•¡íŠ¸ 18ë²„ì „ ì‚´í´ë³´ê¸°
### 10.2.1 ìƒˆë¡œ ì¶”ê°€ëœ í›… ì‚´í´ë³´ê¸°
#### useId
> ì»´í¬ë„ŒíŠ¸ ë³„ ìœ ë‹ˆí¬í•œ ê°’ì„ ìƒì„±í•˜ëŠ” í›…
- Math.random ì‚¬ìš© ì‹œ ì„œë²„ì˜ ê°’ê³¼ í´ë¼ì´ì–¸íŠ¸ì—ì„œ í•˜ì´ë“œë ˆì´ì…˜í•œ ê°’ì´ ë‹¤ë¥´ë‹¤ëŠ” ì—ëŸ¬ ë°œìƒ
- ê°™ì€ ì»´í¬ë„ŒíŠ¸ì—¬ë„ ì¸ìŠ¤í„´ìŠ¤ê°€ ë‹¤ë¥´ë©´ ëœë¤í•œ ê°’ ìƒì„±
- useIdëŠ” `:`ë¡œ ê°ì‹¸ì ¸ ìˆìŒ
- CSS ì„ íƒìë‚˜ querySelectorì—ì„œ ë™ì‘í•˜ì§€ ì•Šë„ë¡ í•¨
```ts
function Child() {
  const id = useId()
  return <div>child: {id}</div>
}

function SubChild() {
  const id = useId()

  retrn (
    <div>
      SubChild: {id}
      <Child />
    </div>
  )
}

export default function Random() {
  const id = useId()
  return (
    <>
      <div>Home: {id}</div> // :Rm:
      <SubChild />  // :Ram:, :R7am:
      <Child /> // :Rem:
    </>
  )
}
```

#### useTransition
> UI ë°˜ì‘ì„±ì„ ìœ ì§€í•˜ë©° ë¹„ë™ê¸°ì ìœ¼ë¡œ ìƒíƒœë¥¼ ì—…ë°ì´íŠ¸í•˜ëŠ” í›…

- ë¬´ê±°ìš´ ë Œë”ë§ ì‘ì—… ë¯¸ë£¨ê¸°, ë” ë‚˜ì€ UX ê²½í—˜ ì œê³µ ê°€ëŠ¥
- ëŠë¦° ì‘ì—…ì´ í¬í•¨ëœ í˜ì´ì§€ì¸ ê²½ìš° ë‹¤ìŒ í˜ì´ì§€ë¥¼ ëˆŒëŸ¬ë„ ë Œë”ë§ì´ ëë‚˜ê³  ë„˜ì–´ê°
- ì´ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ useTransition í›… ì‚¬ìš©
- useTransition í›… ì‚¬ìš© ì‹œ ëŠë¦° ì‘ì—…ì„ ë Œë”ë§í•  ë•Œ 'ë¡œë”© ì¤‘'ì´ í‘œì‹œë˜ê³ , ë‹¤ë¥¸ í˜ì´ì§€ë¡œ ì´ë™ ì‹œ ì¦‰ì‹œ ë Œë”ë§ì´ ì¤‘ë‹¨ë¨
```ts
export default function TabContainer() {
  const [isPending, startTransition] = useTransition()
  const [tab, setTab] = useState<Tab>('about')

  function selectTab(nextTab: Tab) {
    startTransition(() => setTab(nextTab))
  }

  return (
    <>
      {isPending ? 'ë¡œë”©ì¤‘' : (
        // ...
      )}
    </>
  )
}
```
- isPending: ìƒíƒœ ì—…ë°ì´íŠ¸ê°€ ì§„í–‰ ì¤‘ì¸ì§€ í™•ì¸í•˜ëŠ” boolean
- startTransition: ê¸´ê¸‰í•˜ì§€ ì•Šì€ ìƒíƒœ ì—…ë°ì´íŠ¸ë¡œ ê°„ì£¼í•  set í•¨ìˆ˜
- ì»´í¬ë„ŒíŠ¸ë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ì„ ê²½ìš° `import { startTransition } from 'react'` ì‚¬ìš©

#### useDeferredValue
> ë¦¬ë Œë”ë§ì´ ê¸‰í•˜ì§€ ì•Šì€ ë¶€ë¶„ ì§€ì—°ì„ ìœ„í•œ í›…

- ë””ë°”ìš´ìŠ¤ì™€ ë¹„ìŠ·
- ë””ë°”ìš´ìŠ¤ëŠ” ê³ ì • ì§€ì—° ì‹œê°„ í•„ìš”, useDeferredValueëŠ” ì²«ë²ˆì§¸ ë Œë”ë§ì´ ì™„ë£Œëœ ì´í›„ ì§€ì—°ëœ ë Œë”ë§ ìˆ˜í–‰
```ts
const [text, setText] = useState('')
const deferredText = useDeferredValue(text)

const list = useMemo(() => {
	const arr = Array.from({ length: deferredText.length }).map(() => deferredText)

	return (
		<ul>
		
		{arr.map((str, index) => (
			<li key={index}>{str}</li>
		))}	</ul>
	)
}, [deferredText])
```
- ìœ„ ì½”ë“œì—ì„œ ì¦ì€ ë³€ê²½ì´ ìˆëŠ” textë¥¼ ë¨¼ì € ì—…ë°ì´íŠ¸/ë Œë”ë§ í›„ ì—¬ìœ ê°€ ìˆì„ ë•Œ deferredTextë¥¼ í™œìš©í•´ list ìƒì„±

#### useSyncExternalStore
> ì™¸ë¶€ ìƒíƒœ êµ¬ë…í•˜ëŠ” í›…

- useSubscription ëŒ€ì²´
- `Tearing`: ì™¸ë¶€ ìƒíƒœ ê°’ ì‚¬ìš© ì‹œ ë‚´ë¶€ ìƒíƒœì™€ì˜ ë¶ˆì¼ì¹˜ë¡œ ë Œë”ë§ì´ ë¶ˆì•ˆì •í•´ì§€ëŠ” í˜„ìƒ
- v18ì—ì„œ ë™ì‹œì„± ëª¨ë“œ ë„ì…
- useTransition, useDeferredValueì™€ ê°™ì€ ìµœì í™” ê¸°ëŠ¥ì´ ë Œë”ë§ ì§€ì—° ì²˜ë¦¬
- ì™¸ë¶€ ìƒíƒœ ì²˜ë¦¬ ì‹œ ë™ì‹œì„± ë¬¸ì œê°€ ì—¬ì „íˆ ë°œìƒí•  ìˆ˜ ìˆìŒ
- ì™¸ë¶€ ìŠ¤í† ì–´ ë°ì´í„° ë³€ê²½ ë˜í•œ ë¦¬ë Œë”ë§ ë°œìƒ ê°€ëŠ¥ì„± ë†’ìŒ
```ts
function subscribe(callback: (this: Window, ev: UIEvent) => void) {
  window.addEventListener('resize', callback)
  return () => {
    window.removeEventListener('resize', callback)
  }
}

export default function App() {
  const windowSize = useSyncExternalStore(
    subscribe,
    () => window.innerWidth,
    () => 0
  )

  return <>{windowSize}</>
}
```

#### useInsertionEffect
> CSS-in-js ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ìœ„í•œ í›…
- í´ë¼ì´ì–¸íŠ¸ ë Œë”ë§ ì‹œ ë¬´ê±°ìš´ ì‘ì—…ì´ ë°©ì§€ë¥¼ ìœ„í•´ ì„œë²„ ì‚¬ì´ë“œì—ì„œ ìŠ¤íƒ€ì¼ ì½”ë“œ ì‚½ì…
- useEffectì™€ ë™ì¼í•œ í˜•íƒœ
- ì‹¤í–‰ ìˆœì„œ: useEffect -> useLayoutEffect -> useInsertionEffect

<br />

### 10.2.2 react-dom/client
#### createRoot
> react-dom render ë©”ì„œë“œë¥¼ ëŒ€ì²´í•  ìƒˆë¡œìš´ ë©”ì„œë“œ
- v18ì—ì„œëŠ” createRoot + render í•¨ê»˜ ì‚¬ìš©
```js
// before
ReactDOM.render(<App />, document.getElementById('root'))

// after
const root = ReactDOM.createRoot(document.getElementById('root'))
root.render(<App />)
```

#### hydrateRoot
> SSR ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ Hydrationì„ í•˜ê¸° ìœ„í•œ ìƒˆë¡œìš´ ë©”ì„œë“œ
```js
// before
ReactDOM.hydrate(<App />, document.getElementById('root'))

// after
ReactDOM.hydrateRoot(document.getElementById('root'), <App />)
```

<br />

### 10.2.3 react-dom/server
#### renderToPipeableStream
> ë¦¬ì•¡íŠ¸ ì»´í¬ë„ŒíŠ¸ë¥¼ HTMLë¡œ ë Œë”ë§í•˜ëŠ” ë©”ì„œë“œ
- ì ì§„ì  HTML ë Œë”ë§, ì¤‘ê°„ì— script ì‚½ì… ë“± ìˆ˜í–‰
- hydrateRootê³¼ í•¨ê»˜ ì‚¬ìš© ì‹œ ì²«ë²ˆì§¸ ë¡œë”©ì„ ë§¤ìš° ë¹ ë¥´ê²Œ ìˆ˜í–‰í•  ìˆ˜ ìˆìŒ
- renderToPipeableStream ì‚¬ìš© ì‹œ ì•„ì§ ëª» ë°›ì€ ë°ì´í„°ë¥¼ Suspenseì˜ fallbackìœ¼ë¡œ ë°›ìŒ
```jsx
function render(url, res) {
  let didError = false
  const data = createServerData()
  const stream = renderToPipeableStream(
    <DataProvider data={data}>
      <App asseets={assets}>
    </DataProvider>,
    {
      bootstrapScripts: [assets['main.js']],
      onShellReady() {
        res.statusCode = didError ? 500 : 200
        res.setHeader('Content-type', 'text/html')
        stream.pipe(res)
      },
      onError(x) {
        didError = true
        console.error(x)
      },
    },
  )
  setTimeout(() => stream.abort(), ABORT_DELAY)
}

export default function App({assets}) {
  return (
    <Html assets={assets} title="Hello">
      <Suspense fallback={<Spinner />}>
        <ErrorBoundary FallbackComponent={Error}>
          <Content />
        </ErrorBoundary>
      </Suspense>
    </Html>
  )
}
```

#### renderToReadableStream
- ì›¹ ìŠ¤íŠ¸ë¦¼ ê¸°ë°˜ ì‘ë™
- Cloudflareë‚˜ Denoì™€ ê°™ì€ ì›¹ ìŠ¤íŠ¸ë¦¼ì„ ì‚¬ìš©í•˜ëŠ” ëª¨ë˜ ì—£ì§€ ëŸ°íƒ€ì„ í™˜ê²½ì—ì„œ ì‚¬ìš©

<br />

### 10.2.4 ìë™ ë°°ì¹˜ Automatic Batching
- ë¦¬ì•¡íŠ¸ê°€ ì—¬ëŸ¬ ìƒíƒœ ì—…ë°ì´íŠ¸ë¥¼ í•˜ë‚˜ì˜ ë¦¬ë Œë”ë§ìœ¼ë¡œ ë¬¶ëŠ” ì„±ëŠ¥ í–¥ìƒ ë°©ë²•
- v18ë¶€í„° createRootë¡œ ë£¨íŠ¸ ì»´í¬ë„ŒíŠ¸ êµ¬í˜„ ì‹œ ëª¨ë“  ì—…ë°ì´íŠ¸ê°€ ë°°ì¹˜ ì‘ì—…ìœ¼ë¡œ ìµœì í™” ê°€ëŠ¥
- ì˜ˆ) ë™ê¸°, ë¹„ë™ê¸°, ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ë“±

<br />

### 10.2.5 ë”ìš± ì—„ê²©í•´ì§„ ì—„ê²© ëª¨ë“œ
#### ë¦¬ì•¡íŠ¸ ì—„ê²© ëª¨ë“œ
- ì ì¬ì  ë²„ê·¸ë¥¼ ì°¾ëŠ” ë° ë„ì›€ì´ ë˜ëŠ” ì»´í¬ë„ŒíŠ¸
```
root.render(
  <StrictMode>
    <App />
  </StrictMode>
)
```
- UNSAFE_ê°€ ë¶™ì€ ìƒëª…ì£¼ê¸° ë©”ì„œë“œ ì‚¬ìš© ì‹œ ì—ëŸ¬ ë°œìƒ
- createRef ì—†ì´ ì»´í¬ë„ŒíŠ¸ ë‚´ë¶€ì—ì„œ ìƒì„±ëœ refë¡œ DOM ë…¸ë“œë¥¼ ì°¸ì¡°í•˜ëŠ” ê²ƒ ê°€ëŠ¥
- childContextType, getChildContext ì‚¬ìš© êµ¬ Context APIëŠ” ì—ëŸ¬ ì¶œë ¥  - í´ë˜ìŠ¤ ì»´í¬ë„ŒíŠ¸ì˜ constructor, render ë“±, setStateì˜ ì²«ë²ˆì§¸ í•¨ìˆ˜, í•¨ìˆ˜ ì»´í¬ë„ŒíŠ¸ì˜ body ë“±ì„ ì˜ë„ì ìœ¼ë¡œ ì´ì¤‘ í˜¸ì¶œ


<br />

### 10.2.6 Suspense ê¸°ëŠ¥ ê¹…í™”
- Suspense: ì»´í¬ë„ŒíŠ¸ë¥¼ ë™ì ìœ¼ë¡œ ê°€ì ¸ì˜¬ ìˆ˜ ìˆê²Œ ë„ì™€ì£¼ëŠ” ê¸°ëŠ¥
- v18 ì´ì „, Suspense ì¶œë ¥ ì´ ì „ì— useEffect ì‹¤í–‰, ì„œë²„ ì‚¬ìš© ê¸ˆì§€ ë“±ì˜ ë¬¸ì œë¥¼ ë°œê²¬í•¨
- v18ë¶€í„° Suspense ì •ì‹ ì§€ì›