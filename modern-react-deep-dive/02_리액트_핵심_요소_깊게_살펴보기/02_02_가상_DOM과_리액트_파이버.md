# 2. 리액트 핵심 요소 깊게 살펴보기

## 🏷 가상 DOM과 리액트 파이버

### 2.2.1 DOM과 브라우저 렌더링 과정

#### DOM (Document Object Model)

- 웹 페이지에 대한 인터페이스, 웹 페이지의 콘텐츠와 구조 출력에 대한 정보를 가짐

#### 렌더링 과정

1. 브라우저 주소 창에 서비스 주소 입력
   > 입력된 URL을 기반으로 DNS 조회를 수행해 서버의 IP 주소 획득<br />
   > DNS 조회: 입력된 도메인 이름을 IP 주소로 변환하는 과정
2. 사용자가 요청한 주소를 방문해 HTML 파일 다운로드
3. 렌더링 엔진은 HTML을 파싱해 DOM 노드를 트리(DOM) 구조로 생성
4. CSS 파싱으로 CSS 노드를 트리(CSSOM) 구조로 생성
   > `<link>` 태그로 연결된 CSS 파일 다운로드
5. JavaScript 파일 다운로드 및 실행
   > `<script>` 태그로 연결된 JS 파일 다운로드 및 실행
6. 레이아웃 계산 (Reflow)
   > 렌더 트리를 기반으로 사용자 눈에 보이는 DOM 노드 순회 방문<br />
   > 예: `display: none`과 같이 눈에 안 보이는 건 방문하지 않음
7. 페인팅 (Painting)
   > 위 노드에 대한 CSSOM 정보를 찾아 CSS 스타일 정보를 노드에 적용
8. 컴포지팅 (Compositing)
   > 여러 레이어로 나뉜 요소들을 하나의 최종 화면으로 합성
9. 최종 출력

#### 재조정 과정 (reconciliation)

> → 2.4.3 리액트의 렌더링 프로세스

- 가상의 DOM을 사용하여 변경된 상태와 현재 상태 비교, 실제 DOM에 반영하는 과정
- 불필요한 DOM 업데이트 방지
- 과정: 상태나 props 변경 -> 기존 가상 DOM과 비교 -> 변경된 부분만 업데이트

<br />

### 2.2.2 가상 DOM 탄생 배경

```
- 렌더링 이후 인터렉션으로 인한 레이아웃, 리페인팅 발생 -> 많은 비용 지불
- 가상 DOM은 DOM을 메몰에 저장 후 실제 변경에 대한 준비가 완료되었을 때 반영
- 여러 번 발생하는 렌더링 과정 최소화, 브라우저와 개발자의 부담 감소
```

<br />

### 2.2.3 가상 DOM을 위한 아키텍처, 리액트 파이버

#### 리액트 파이버

- 리액트에 서 관리하는 자바스크립트 객체, 가상 DOM과 렌더링 과정 최적화를 도움
- 가상 DOM과 실제 DOM을 비교해 변경 사항 수정, 파이버를 기준으로 화면 렌더링 요청
- 리액트 요소와 유사하나 가급적이면 요소를 재사용함

#### 리액트 파이버 트리

- 리액트 내 존재: 현재 모습을 담은 트리, 작업 중인 상태 workInProgress 트리
- 작업이 끝나면 workInProgress 트리를 현재 트리로 변경 => `더블 버퍼링`

#### 더블 버퍼링

- 보이지 않는 곳에서 그 다음으로 그려야할 그림을 미리 그린 다음, 완성되면 현재 상태를 새로운 그림으로 바꾸는 기법
- 화면이 깜빡이거나 중된되는 현상 최소화

#### 파이버의 작업 순서

1. beginWork() 함수를 실행 해 파이버 작업 수행
2. 작업이 끝난다면 completeWork()으로 파이버 작업 완료
3. 형제가 있다면 형제로 이동
4. 모두 끝났다면 작업이 완료됐음을 알림

- 예시

  > 렉시컬 스코프 실행 순서와 유사함

  ```jsx
  <A1>                    // (1) begin
  	<B1>안녕하세요</B>     // (2) begin + complete
  	<B2>                // (3) begin
  		<C1>            // (4) begin
  			<D1 />      // (5) begin + complete
  			<D2 />      // (6) begin + complete
  		</C1>           // (7) complete
  	</B2>               // (8) complete
  </A1>                   // (9) complete
  ```

<br />

### 2.2.4 파이버와 가상 DOM

```
- 파이버는 리액트 아키텍처 내부에서 비동기적으로 수행, 그러나 실제 DOM에서 반영하는 것은 동기적
```

<br />

### 2.2.5 정리

```
- 파이버와 재조정자(reconcil)가 내부적 알고리즘을 통해 변경점 파악 및 관리
- 이로 인해 대규모 웹 애플리케이션을 효율적으로 유지보수할 수 있음
```
